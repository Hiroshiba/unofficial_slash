# 調査項目: 微分可能DSP・損失関数関連

## 1. CQT ピッチシフトの境界処理

### 質問内容
CQT の周波数軸シフト（±14 bins）における端の周波数ビンでの境界処理方法は？

### 背景
- ピッチシフト処理で CQT (T×205 bins) → C_shift 生成
- ±14 bins シフトで端の bins が範囲外になる
- 勾配計算への影響を最小化する処理が必要

### 調査ポイント
1. 境界処理の選択肢
   - ゼロパディング
   - 循環シフト（wrap-around）
   - 最近傍値での埋め合わせ
   - 線形外挿
2. 各手法の音響的妥当性
   - 周波数スペクトル特性への影響
   - ピッチ一貫性への効果
3. 勾配伝播への影響
4. SPICE, PESTO での実装例

### 参考資料
- SPICE論文でのピッチシフト実装
- librosa.cqt でのパディング処理
- 信号処理における境界条件処理

---

## 2. ガウシアンノイズ Z の適用方法

### 質問内容
Pseudo periodic excitation spectrum (Equation 4) でのガウシアンノイズ Z の具体的な適用方法と微分可能性は？

### 背景
- Equation 4: E*_p = max(X, ε)² + |Z · ε|
- Z ∈ R^(T×K) with elements from standard normal distribution
- 勾配計算での確率的要素の扱いが不明

### 調査ポイント
1. ガウシアンノイズの生成タイミング
   - 前向き計算時に固定？
   - バッチごと・サンプルごとの更新？
2. 微分可能性の確保
   - Z に対する勾配の扱い
   - ノイズ項の勾配停止の必要性
3. |Z · ε| の絶対値演算
   - 微分における特異点の回避
   - 滑らかな近似の必要性
4. ハイパーパラメータ ε=0.001 の影響

### 参考資料
- DDSP論文でのノイズ項実装
- 確率的勾配計算での処理例
- PyTorchでの確率的層の実装

---

## 3. ハーモニクス次数の決定方法

### 質問内容
DDSP Synthesizer での周期励起信号 e_p 生成における、ハーモニクス次数の決定方法は？

### 背景
- 論文footnote 3: "ep represents a time-domain periodic excitation signal, created by combining multiple sine waves based on pt and its harmonics"
- 何次まで含めるかが品質と計算量に影響

### 調査ポイント
1. ハーモニクス次数の上限設定
   - Nyquist周波数（12kHz）までの制限
   - 基本周波数に応じた動的調整
   - 固定次数 vs 可変次数
2. 各ハーモニクスの振幅制御
   - 1/n 減衰則の適用
   - 学習可能な振幅係数
   - スペクトル包絡による制御
3. 計算効率の最適化
   - 高速フーリエ変換の活用
   - 並列計算対応
4. 音質への影響評価

### 参考資料
- DDSP論文 Section 3.1: Harmonic Oscillator
- WORLD ボコーダーでのハーモニクス処理
- 音響合成でのハーモニクス生成手法

---

## 4. GED損失での S~1, S~2 生成方法

### 質問内容
Reconstruction Loss (Equation 8) の GED 計算で必要な2つの生成スペクトログラム S~1, S~2 の具体的な生成方法の違いは？

### 背景
- Equation 8: L_recon = ||ψ(S~1) - ψ(S)||₁ - α||ψ(S~1) - ψ(S~2)||₁
- Repulsive term のために異なる S~1, S~2 が必要
- 生成方法が GED の効果に直接影響

### 調査ポイント
1. S~1, S~2 の生成法の違い
   - 異なるランダムシード使用
   - パラメータの小さな摂動
   - 異なるノイズ付加
   - 独立な前向き計算
2. GED 原論文での実装例
3. 計算グラフの分離方法
   - 共通パラメータの勾配流
   - detach() の適用箇所
4. Repulsive term の効果検証

### 参考資料
- Gritsenko et al. 2020: "A spectral energy distance for parallel speech synthesis"
- GED実装のオープンソース例
- 対照学習でのnegative sampling手法

---

## 5. Fine Structure Spectrum の計算安定性

### 質問内容
各損失で使用される fine structure spectrum ψ(S) = log(S) - W(log(S)) の数値安定性確保方法は？

### 背景
- 複数箇所で使用される重要な前処理
- log(S) での零除算回避が必要
- スペクトル包絡 W(·) の計算精度が影響

### 調査ポイント
1. 零除算・負値の回避
   - スペクトログラムの下限値設定
   - log(S + eps) での eps 値
   - クリッピング処理の適用
2. Lag-window法 W(·) の安定実装
   - 窓関数の正規化
   - 境界条件の処理
   - 数値誤差の蓄積回避
3. 勾配計算での安定性
   - log の微分での特異点
   - チェーン則による誤差伝播
4. バッチ処理での一貫性

### 参考資料
- 音響信号処理での対数スペクトル計算
- PyTorchでの数値安定実装例
- WORLD実装での安定化手法

---

## 6. V/UV マスクの勾配制御

### 質問内容
Pseudo Spectrogram Loss (Equation 6) での V/UV マスク v の勾配制御方法は？

### 背景
- L_pseudo = ||ψ(S*) - ψ(S)||₁ ⊙ (v × 1_K)
- V/UV検出器の出力 v が損失に直接影響
- v の勾配がピッチエンコーダに逆流する可能性

### 調査ポイント
1. V/UV マスクの勾配流制御
   - v に対する勾配停止（detach）
   - ピッチエンコーダへの影響分離
2. マスク適用のタイミング
   - 損失計算時のみ
   - 特徴量計算段階
3. 有声フレームのみ学習の効果
   - 無声部分での F0 最適化の停止
   - 学習効率への影響
4. 閾値 θ=0.5 の微分不可能性対応

### 参考資料
- マスクを用いた損失の実装例
- 音声処理でのV/UV処理手法
- 勾配制御のベストプラクティス